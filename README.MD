# TVWS - TradingView WebSocket Library

ğŸš€ **Browser-compatible TradingView WebSocket API** with extensible event system for real-time market data and advanced TradingView features.

[![npm version](https://badge.fury.io/js/tvws.svg)](https://badge.fury.io/js/tvws)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

## âœ¨ Features

- ğŸŒ **Browser & CDN Ready** - Works seamlessly in browsers and available via CDN
- ğŸ”„ **Multiple Endpoints** - Access different TradingView data sources
- ğŸ“Š **Comprehensive Market Data** - Forex, crypto, stocks, commodities, and more
- ğŸ¯ **High Performance** - Optimized WebSocket connections with efficient data handling
- ğŸ›¡ï¸ **Full TypeScript Support** - Complete type definitions included
- ğŸ” **Optional Authentication** - Access premium data with TradingView session
- ğŸ“ˆ **Multiple Timeframes** - Support for all TradingView chart intervals
- âš¡ **Extensible Event System** - Composable handlers for studies, replay, quotes, and more
- ğŸ§© **Modular Architecture** - Clean handler registry for adding new TradingView features
- ğŸ“¦ **Zero Dependencies** - Pure WebSocket API, no external runtime dependencies

## ğŸ“¦ Installation

### NPM
```bash
npm install tvws
```

### Yarn
```bash
yarn add tvws
```

### Bun
```bash
bun add tvws
```

## ğŸš€ Quick Start

### ES Modules (Recommended)
```javascript
import { connect, getCandles } from 'tvws';

// Connect to TradingView
const connection = await connect({
  endpoint: 'data' // 'data' | 'prodata' | 'widgetdata' | 'charts-polygon'
});

// Fetch candlestick data
const candles = await getCandles({
  connection,
  symbols: ['FX:EURUSD', 'BINANCE:BTCUSDT.P'],
  amount: 100,
  timeframe: '1D'
});

console.log('Fetched candles:', candles);
await connection.close();
```

### CommonJS
```javascript
const { connect, getCandles } = require('tvws');

async function fetchData() {
  const connection = await connect();
  const candles = await getCandles({
    connection,
    symbols: ['FX:EURUSD'],
    amount: 100,
    timeframe: '1D'
  });
  console.log(candles);
  await connection.close();
}
```

## ğŸŒ CDN Usage

```html
<!DOCTYPE html>
<html>
<head>
  <script type="module">
    import { connect, getCandles } from 'https://unpkg.com/tvws@latest/dist/index.js';
    
    async function example() {
      const connection = await connect();
      const candles = await getCandles({
        connection,
        symbols: ['FX:EURUSD'],
        amount: 50,
        timeframe: '1h'
      });
      console.log('Candle data:', candles);
    }
    
    example();
  </script>
</head>
</html>
```

## ğŸ”§ Development Setup

This project uses Bun for a minimal, fast development and build process.

### Prerequisites
- [Bun](https://bun.sh/) (v1.0+) or [Node.js](https://nodejs.org/) (v16+)
- Git

### Clone & Install
```bash
git clone https://github.com/badsector666/tvws.git
cd tvws
bun install  # or npm install
```

### Build for Production
```bash
# Build all formats (ESM, UMD, CJS) and TypeScript definitions
bun run build

# Build individual formats
bun run build:umd     # UMD for browsers/CDN
bun run build:cjs     # CommonJS for Node.js
bun run build:types   # TypeScript definitions only
```

### Available Scripts
```bash
bun run build        # Build all formats and type definitions
bun run build:umd    # Build UMD format for browser/CDN use
bun run build:cjs    # Build CommonJS format for Node.js
bun run build:types  # Build TypeScript type definitions only
bun run typecheck    # TypeScript type checking
bun run clean        # Clean dist directory
```

## ğŸ“Š API Reference

### `connect(options?)`
Create a WebSocket connection to TradingView.

**Parameters:**
```typescript
interface ConnectOptions {
  sessionId?: string;    // Optional TradingView session ID for premium data
  endpoint?: string;     // WebSocket endpoint (default: 'data')
  debug?: boolean;       // Enable debug logging (default: false)
}
```

**Available Endpoints:**
- `"data"` - Standard data endpoint (recommended)
- `"prodata"` - Premium data endpoint (requires authentication)
- `"widgetdata"` - Widget data endpoint
- `"charts-polygon"` - Polygon.io charts data

**Returns:** `Promise<TradingviewConnection>`

### `getCandles(params)`
Fetch historical candlestick data.

**Parameters:**
```typescript
interface GetCandlesParams {
  connection: TradingviewConnection;  // Active connection from connect()
  symbols: string[];                 // Array of trading symbols
  amount?: number;                   // Number of candles (default: maximum available)
  timeframe?: string | number;       // Chart timeframe (default: "1D")
}
```

**Returns:** `Promise<CandleData[]>`

### `connection.close()`
Close the WebSocket connection.

## ğŸ“ˆ Supported Symbols

### Forex Pairs
```javascript
// Major pairs
'FX:EURUSD', 'FX:GBPUSD', 'FX:USDJPY', 'FX:USDCHF'

// Cross pairs  
'FX:EURGBP', 'FX:EURJPY', 'FX:GBPJPY', 'FX:EURCHF'

// Exotics
'FX:USDTRY', 'FX:USDZAR', 'FX:USDMXN'
```

### Cryptocurrencies
```javascript
// Bitcoin
'CRYPTO:BTCUSD', 'CRYPTO:BTCUSDT', 'BINANCE:BTCUSDT.P'

// Ethereum
'CRYPTO:ETHUSD', 'CRYPTO:ETHUSDT', 'BINANCE:ETHUSDT.P'

// Altcoins
'CRYPTO:ADAUSD', 'BINANCE:ADAUSDT.P', 'BINANCE:SOLUSDT.P'
```

### Stocks
```javascript
// US Stocks
'NASDAQ:AAPL', 'NASDAQ:GOOGL', 'NASDAQ:MSFT'
'NYSE:TSLA', 'NYSE:BRK.A', 'NYSE:JPM'

// Indices
'AMEX:SPY', 'NASDAQ:QQQ', 'NYSEARCA:DIA'
```

### Commodities
```javascript
// Gold & Silver
'FOREXCOM:XAUUSD',  // Gold
'FOREXCOM:XAGUSD',  // Silver

// Oil
'NYMEX:CL1!',       // Crude Oil
'NYMEX:NG1!',       // Natural Gas
```

## â° Supported Timeframes

### Intraday
```javascript
'1m',   // 1 minute
'3m',   // 3 minutes
'5m',   // 5 minutes
'15m',  // 15 minutes
'30m',  // 30 minutes
'45m',  // 45 minutes
'1h',   // 1 hour
'2h',   // 2 hours
'3h',   // 3 hours
'4h',   // 4 hours
```

### Daily & Above
```javascript
'1D',   // Daily
'1W',   // Weekly
'1M',   // Monthly
```

### Numeric Timeframes
```javascript
1,      // 1 minute
5,      // 5 minutes
15,     // 15 minutes
60,     // 1 hour
240,    // 4 hours
1440,   // 1 day
10080   // 1 week
```

## ğŸ“‹ Response Data Structure

```typescript
interface CandleData {
  timestamp: number;    // Unix timestamp (seconds)
  open: number;         // Open price
  high: number;         // High price
  low: number;          // Low price
  close: number;        // Close price
  volume: number;       // Trading volume
}
```

**Example Response:**
```javascript
[
  {
    timestamp: 1640995200,
    open: 1.13500,
    high: 1.13750,
    low: 1.13400,
    close: 1.13650,
    volume: 1250
  },
  {
    timestamp: 1641081600,
    open: 1.13650,
    high: 1.13800,
    low: 1.13500,
    close: 1.13750,
    volume: 1380
  }
]
```

## ğŸš€ Advanced Features

### Studies
Create and manage custom technical studies on TradingView charts.

```javascript
import { createStudy, modifyStudy, removeStudy } from 'tvws';

const connection = await connect();

// Create a custom study
const studyData = await createStudy(connection, {
  symbol: 'BINANCE:BTCUSDT.P',
  studyId: 'my_rsi_study',
  script: `
    study("RSI Study")
    rsi = rsi(close, 14)
    plot(rsi)
  `,
  inputs: {
    length: 14,
    source: 'close'
  }
});

// Modify an existing study
modifyStudy(connection, 'my_rsi_study', {
  inputs: { length: 21 }
});

// Remove a study
removeStudy(connection, 'my_rsi_study');
```

### Replay
Control historical data playback for backtesting and analysis.

```javascript
import { createReplay, ReplayController } from 'tvws';

const connection = await connect();

// Create a replay session
const replayState = await createReplay(connection, {
  symbols: ['BINANCE:BTCUSDT.P'],
  timeframe: '1h',
  startTime: Date.now() - (7 * 24 * 60 * 60 * 1000), // 7 days ago
  endTime: Date.now(),
  speed: 1 // 1x speed
});

// Control replay playback
const controller = new ReplayController(connection, replayState.sessionId);
controller.start(2); // Start at 2x speed
controller.step(5);  // Move forward 5 bars
controller.pause();  // Pause playback
controller.reset();  // Reset to beginning
```

### Real-time Quotes
Get real-time quote data for multiple symbols with custom fields.

```javascript
import { getQuotes, addQuoteSymbols, setQuoteFields } from 'tvws';

const connection = await connect();

// Get real-time quotes
const quotes = await getQuotes(connection, {
  symbols: ['AAPL', 'GOOGL', 'MSFT'],
  fields: ['price', 'volume', 'change', 'change_percent', 'bid', 'ask']
});

console.log(quotes.get('AAPL')); // { price: 150.25, volume: 1000000, ... }

// Add more symbols to existing quote session
addQuoteSymbols(connection, quotes.sessionId, ['TSLA', 'AMZN']);

// Change quote fields
setQuoteFields(connection, quotes.sessionId, ['price', 'volume', 'market_cap']);
```

### Event-Driven Architecture
The library uses a composable event handler system for extensibility.

```javascript
import { connect } from 'tvws';

const connection = await connect();

// Subscribe to specific event types only
const unsubscribe = connection.subscribe(
  (event) => {
    console.log('Custom event handler:', event);
  },
  // Filter for specific events
  (event) => ['timescale_update', 'study_completed'].includes(event.name),
  // Priority (higher = called first)
  10
);

// Add multiple handlers with different priorities
connection.subscribe(console.log, null, 5);  // Lower priority
connection.subscribe(console.log, null, 15); // Higher priority

// Clean up when done
unsubscribe();
```

## ğŸ“š Examples & Demos

For comprehensive examples and live demos, visit our **demo repository**:

ğŸ”— **[tvws-demo](https://github.com/badsector666/tvws-demo)**

### Available Examples
- **Live Demo** - Interactive trading interface with real-time data
- **WebSocket Connection** - Connect to TradingView endpoints
- **Authentication** - Optional session-based authentication
- **Multiple Symbols** - Query multiple trading pairs simultaneously
- **All Timeframes** - Support for every TradingView timeframe
- **Performance Metrics** - Connection and data performance monitoring
- **Error Handling** - Comprehensive error management

### Quick Start with Demo
```bash
git clone https://github.com/badsector666/tvws-demo.git
cd tvws-demo
npm install && npm run dev
```

Visit http://localhost:5173 for the live demo!

## ğŸ¯ Advanced Usage Examples

### Multiple Symbols & Timeframes
```javascript
import { connect, getCandles } from 'tvws';

const connection = await connect({ endpoint: 'data' });

// Fetch data for multiple symbols and timeframes
const results = await Promise.all([
  getCandles({
    connection,
    symbols: ['FX:EURUSD', 'FX:GBPUSD'],
    timeframe: '1h',
    amount: 100
  }),
  getCandles({
    connection,
    symbols: ['BINANCE:BTCUSDT.P'],
    timeframe: '15m',
    amount: 200
  }),
  getCandles({
    connection,
    symbols: ['NASDAQ:AAPL'],
    timeframe: '1D',
    amount: 30
  })
]);

console.log('EURUSD 1H:', results[0]);
console.log('BTC 15m:', results[1]);
console.log('AAPL Daily:', results[2]);

await connection.close();
```

### With Authentication (Premium Data)
```javascript
import { connect, getCandles } from 'tvws';

const connection = await connect({
  endpoint: 'prodata',
  sessionId: 'your_tradingview_session_id_here'
});

// Access premium data with authentication
const premiumData = await getCandles({
  connection,
  symbols: ['FOREXCOM:XAUUSD'], // Gold with premium data
  timeframe: '1m',
  amount: 1000
});

await connection.close();
```

### Error Handling
```javascript
import { connect, getCandles } from 'tvws';

async function fetchDataWithRetry() {
  try {
    const connection = await connect({
      endpoint: 'data',
      debug: true // Enable debug logging
    });
    
    const candles = await getCandles({
      connection,
      symbols: ['FX:EURUSD'],
      timeframe: '1h',
      amount: 100
    });
    
    console.log('Success:', candles);
    await connection.close();
    
  } catch (error) {
    console.error('Error fetching data:', error.message);
    
    // Retry with different endpoint
    try {
      const backupConnection = await connect({ endpoint: 'widgetdata' });
      const candles = await getCandles({
        connection: backupConnection,
        symbols: ['FX:EURUSD'],
        timeframe: '1h',
        amount: 100
      });
      console.log('Backup success:', candles);
      await backupConnection.close();
    } catch (retryError) {
      console.error('Retry failed:', retryError.message);
    }
  }
}
```

### Real-time Updates
```javascript
import { connect, getCandles } from 'tvws';

const connection = await connect();

// Set up real-time updates
connection.on('candle_update', (data) => {
  console.log('New candle:', data);
});

// Fetch initial data
const initialCandles = await getCandles({
  connection,
  symbols: ['BINANCE:BTCUSDT.P'],
  timeframe: '1m',
  amount: 100
});

console.log('Initial candles loaded:', initialCandles.length);
```

## ğŸŒ Web Example

This project includes a complete web interface for testing the library:

### Features
- ğŸ¨ **Modern UI** with DaisyUI + Tailwind CSS
- ğŸ“Š **Interactive Dashboard** for testing all features
- ğŸ” **Authentication Support** with helpful setup guide
- ğŸ“ˆ **Multiple Timeframes** selection with custom candle amounts
- ğŸ” **Real-time Debug Log** with configurable log levels
- ğŸ“Š **Performance Metrics** and connection monitoring
- ğŸ“± **Responsive Design** for all devices

### Running the Example

#### Development Mode (with hot reload)
```bash
cd tvws
bun run dev
# Open http://localhost:5173
```

#### Production Mode
```bash
cd tvws
bun run build    # Build once
bun run preview  # Preview production build
# Open http://localhost:4173
```

#### Custom Server
```bash
cd tvws
bun run build
cd dist
python -m http.server 8080
# Open http://localhost:8080
```

### Example Features
- âœ… **Multiple Endpoints**: Test all TradingView WebSocket endpoints
- âœ… **Symbol Selection**: Add multiple symbols with real-time validation
- âœ… **Timeframe Grid**: Choose from 13 different timeframes
- âœ… **Custom Amounts**: Set custom candle amounts per timeframe
- âœ… **Authentication**: Easy setup with visual guide
- âœ… **Performance Monitoring**: Track request times and success rates
- âœ… **Error Handling**: Comprehensive error reporting
- âœ… **Real-time Logging**: Filterable debug information
- âœ… **Data Export**: Export candle data to various formats

## ğŸ” Authentication Guide

To access premium data or certain symbols, you'll need to provide your TradingView session ID:

### Method 1: Browser Extension
1. Install "EditThisCookie" or similar extension
2. Go to tradingview.com
3. Find and copy the `sessionid` cookie value
4. Use it in your connection

### Method 2: Browser Developer Tools
1. Open https://www.tradingview.com/chart/
2. Open Developer Tools (F12)
3. Go to **Application** â†’ **Storage** â†’ **Cookies** â†’ **https://www.tradingview.com**
4. Find the `sessionid` cookie and copy its value
5. Use it in the connect options:

```javascript
const connection = await connect({
  endpoint: 'prodata', // or 'data'
  sessionId: 'qsxh1x2yz9i4x8x2...' // Your session ID
});
```

### Method 3: Using the Web Example
The built-in web example includes an interactive authentication helper with step-by-step instructions.

## ğŸ› ï¸ Project Structure

```
tvws/
â”œâ”€â”€ src/                    # Library source code
â”‚   â”œâ”€â”€ index.ts           # Main library entry point
â”‚   â”œâ”€â”€ connection.ts      # WebSocket connection handling
â”‚   â”œâ”€â”€ types.ts           # TypeScript type definitions
â”‚   â””â”€â”€ utils.ts           # Utility functions
â”œâ”€â”€ example/               # Web example application
â”‚   â”œâ”€â”€ index.html         # Main HTML file
â”‚   â”œâ”€â”€ script.js          # JavaScript implementation
â”‚   â”œâ”€â”€ styles.css         # Custom CSS styles
â”‚   â””â”€â”€ main.css           # Tailwind + DaisyUI integration
â”œâ”€â”€ dist/                  # Built files (generated)
â”‚   â”œâ”€â”€ index.js           # Built library
â”‚   â”œâ”€â”€ index.d.ts         # Type definitions
â”‚   â””â”€â”€ assets/            # Built example assets
â”œâ”€â”€ tests/                 # Test files
â”œâ”€â”€ docs/                  # Documentation
â”œâ”€â”€ vite.config.ts         # Vite configuration
â”œâ”€â”€ tailwind.config.js     # Tailwind CSS configuration
â”œâ”€â”€ postcss.config.mjs     # PostCSS configuration
â”œâ”€â”€ package.json           # Project dependencies
â””â”€â”€ README.MD              # This file
```

## ğŸ§ª Testing

```bash
# Run tests
bun run test

# Run tests with UI
bun run test:ui

# Type checking
bun run typecheck
```

## ğŸ“ TypeScript Support

Full TypeScript support is included with comprehensive type definitions:

```typescript
import { TradingviewConnection, CandleData, ConnectOptions } from 'tvws';

const connection: TradingviewConnection = await connect({
  endpoint: 'data',
  sessionId: undefined
});

const candles: CandleData[] = await getCandles({
  connection,
  symbols: ['FX:EURUSD'],
  amount: 100,
  timeframe: '1D'
});
```

## ğŸŒ CDN & unpkg

The library is available via CDN for immediate use:

```html
<!-- Latest version -->
<script type="module" src="https://unpkg.com/tvws@latest/dist/index.js"></script>

<!-- Specific version -->
<script type="module" src="https://unpkg.com/tvws@0.0.10/dist/index.js"></script>
```

## ğŸ¤ Contributing

1. Fork the repository
2. Create your feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add some amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

### Development Setup for Contributors
```bash
git clone https://github.com/badsector666/tvws.git
cd tvws
bun install
bun run dev
```

## ğŸ“Š Performance Tips

### Connection Reuse
```javascript
// âœ… Good: Reuse connections
const connection = await connect();
const data1 = await getCandles({ connection, symbols: ['FX:EURUSD'] });
const data2 = await getCandles({ connection, symbols: ['FX:GBPUSD'] });
await connection.close();

// âŒ Avoid: Multiple connections
const conn1 = await connect(); // Creates new WebSocket
const conn2 = await connect(); // Creates another WebSocket
```

### Batch Requests
```javascript
// âœ… Good: Batch symbol requests
const candles = await getCandles({
  connection,
  symbols: ['FX:EURUSD', 'FX:GBPUSD', 'FX:USDJPY'], // Multiple symbols
  timeframe: '1h',
  amount: 100
});

// âŒ Avoid: Multiple individual requests
const eurusd = await getCandles({ connection, symbols: ['FX:EURUSD'] });
const gbpusd = await getCandles({ connection, symbols: ['FX:GBPUSD'] });
```

### Timeframe Optimization
```javascript
// âœ… Recommended amounts per timeframe
const timeframeAmounts = {
  '1m': 1000,    // High frequency
  '5m': 1000,    // High frequency  
  '15m': 500,    // Medium frequency
  '1h': 200,     // Medium frequency
  '1D': 30,      // Low frequency
  '1W': 52,      // Year of weekly data
  '1M': 24       // 2 years of monthly data
};
```

## ğŸ”’ Security & Rate Limiting

- **No API Keys Required**: Uses TradingView's public WebSocket endpoints
- **Rate Limiting**: Be mindful of request frequency to avoid being blocked
- **Session Security**: Session IDs are sensitive - don't expose them in public code
- **Connection Limits**: Avoid creating too many simultaneous connections

## ğŸ› Troubleshooting

### Common Issues

#### "Failed to resolve import" errors
```bash
# Make sure dependencies are installed
bun install

# Clear node_modules and reinstall
rm -rf node_modules bun.lockb
bun install
```

#### WebSocket connection fails
- Check your internet connection
- Try different endpoints: `data`, `prodata`, `widgetdata`
- Verify symbol names are correct

#### CORS errors in browser
- Use HTTPS in production
- Some browsers require secure context for WebSocket connections

#### Authentication not working
- Ensure session ID is current and valid
- Check that the session has access to requested data
- Try without authentication first to verify basic functionality

### Debug Mode
```javascript
// Enable debug logging
const connection = await connect({
  debug: true  // Shows detailed connection logs
});
```

## ğŸ“„ License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## ğŸ™ Acknowledgments

- TradingView for providing the WebSocket API
- The open-source community for WebSocket libraries and tools
- DaisyUI and Tailwind CSS for the beautiful UI components

## ğŸ“ Support

- ğŸ› **Bug Reports**: [GitHub Issues](https://github.com/badsector666/tvws/issues)
- ğŸ’¡ **Feature Requests**: [GitHub Discussions](https://github.com/badsector666/tvws/discussions)
- ğŸ“§ **Email**: badsectorkiller666@gmail.com

---

**â­ Star this repository if it helped you!**

Made with â¤ï¸ by [badsector666](https://github.com/badsector666)